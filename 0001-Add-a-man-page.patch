From eddd43232a4930a807f4cc24ead713f4b11902cf Mon Sep 17 00:00:00 2001
From: Matthias Clasen <mclasen@redhat.com>
Date: Tue, 2 Jul 2013 11:27:48 -0400
Subject: [PATCH 1/3] Add a man page

This is admittedly pretty minimal.

https://bugzilla.gnome.org/show_bug.cgi?id=703470
---
 Makefile.am            |  5 ++++
 configure.ac           | 18 ++++++++++++++
 man/Makefile.am        | 21 ++++++++++++++++
 man/gnome-contacts.xml | 66 ++++++++++++++++++++++++++++++++++++++++++++++++++
 4 files changed, 110 insertions(+)
 create mode 100644 man/Makefile.am
 create mode 100644 man/gnome-contacts.xml

diff --git a/Makefile.am b/Makefile.am
index 40ae6c7..d3a82a5 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -1,6 +1,11 @@
 ACLOCAL_AMFLAGS = -I m4 -I libgd ${ACLOCAL_FLAGS}
 NULL=
 SUBDIRS = libgd src vapi data po
+if BUILD_MAN_PAGES
+SUBDIRS += man
+endif
+DIST_SUBDIRS = libgd src vapi data po man
+
 EXTRA_DIST = \
 	autogen.sh \
 	intltool-extract.in \
diff --git a/configure.ac b/configure.ac
index 58b8f96..a17321c 100644
--- a/configure.ac
+++ b/configure.ac
@@ -11,6 +11,7 @@ AC_CONFIG_FILES([Makefile
 		libgd/Makefile
 		vapi/Makefile
 		src/Makefile
+		man/Makefile
 		data/Makefile
 		po/Makefile.in
 		data/gnome-contacts.desktop.in
@@ -77,6 +78,23 @@ AM_CONDITIONAL(BUILD_CHEESE, test x${have_cheese} = xyes)
 GLIB_COMPILE_RESOURCES=`$PKG_CONFIG --variable glib_compile_resources gio-2.0`
 AC_SUBST(GLIB_COMPILE_RESOURCES)
 
+#################
+# Documentation #
+#################
+
+AC_ARG_ENABLE(man-pages,
+              AC_HELP_STRING([--enable-man-pages],
+                             [build man pages]),,
+              enable_documentation=yes)
+if test x$enable_man_pages = xyes; then
+   AC_PATH_PROG([XSLTPROC], [xsltproc])
+   if test x$XSLTPROC = x; then
+      AC_MSG_ERROR([xsltproc is required to build man pages])
+   fi
+fi
+AM_CONDITIONAL(BUILD_MAN_PAGES, test x$enable_man_pages = xyes)
+
+
 dnl libgd
 LIBGD_INIT([
   gtk-hacks
diff --git a/man/Makefile.am b/man/Makefile.am
new file mode 100644
index 0000000..182800d
--- /dev/null
+++ b/man/Makefile.am
@@ -0,0 +1,21 @@
+XSLTPROC_FLAGS = \
+        --nonet \
+        --stringparam man.output.quietly 1 \
+        --stringparam funcsynopsis.style ansi \
+        --stringparam man.th.extra1.suppress 1 \
+        --stringparam man.authors.section.enabled 0 \
+        --stringparam man.copyright.section.enabled 0
+
+.xml.1:
+	$(AM_V_GEN) $(XSLTPROC) $(XSLTPROC_FLAGS) http://docbook.sourceforge.net/release/xsl/current/manpages/docbook.xsl $<
+
+man_MANS = \
+	gnome-contacts.1
+
+xml_files = $(man_MANS:.1=.xml)
+
+EXTRA_DIST = $(xml_files)
+
+DISTCLEANFILES = $(man_MANS)
+
+-include $(top_srcdir)/git.mk
diff --git a/man/gnome-contacts.xml b/man/gnome-contacts.xml
new file mode 100644
index 0000000..7a3bd20
--- /dev/null
+++ b/man/gnome-contacts.xml
@@ -0,0 +1,66 @@
+<?xml version='1.0'?>
+<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
+        "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd">
+
+<refentry id="gnome-contacts">
+
+        <refentryinfo>
+                <title>gnome-contacts</title>
+                <productname>GNOME</productname>
+
+                <authorgroup>
+                        <author>
+                                <contrib>Maintainer</contrib>
+                                <firstname>Alexander</firstname>
+                                <surname>Larsson</surname>
+                                <email>alexl@redhat.com</email>
+                        </author>
+                </authorgroup>
+
+        </refentryinfo>
+
+        <refmeta>
+                <refentrytitle>gnome-contacts</refentrytitle>
+                <manvolnum>1</manvolnum>
+                <refmiscinfo class="manual">User Commands</refmiscinfo>
+        </refmeta>
+
+        <refnamediv>
+                <refname>gnome-contacts</refname>
+                <refpurpose>Access and store information about contacts</refpurpose>
+        </refnamediv>
+
+        <refsynopsisdiv>
+                <cmdsynopsis>
+                        <command>gnome-contacts <arg choice="opt" rep="repeat">OPTION</arg></command>
+                </cmdsynopsis>
+        </refsynopsisdiv>
+
+        <refsect1>
+                <title>Description</title>
+
+                <para><command>gnome-contacts</command> is a graphical
+                user interface to access and store information about
+                your contacts.</para>
+
+                <para>gnome-contacts uses the folks library to pull
+                together contact information from various sources,
+                including telepathy, evolution-data-server, your
+                configured GNOME online accounts, etc.</para>
+        </refsect1>
+
+        <refsect1>
+                <title>Options</title>
+
+                <variablelist>
+                        <varlistentry>
+                                <term><option>-?</option>, <option>--help</option></term>
+
+                                <listitem><para>Prints a short help
+                                text and exits.</para></listitem>
+                        </varlistentry>
+
+                </variablelist>
+        </refsect1>
+
+</refentry>
-- 
1.8.3.1

